# =============================================================================
# IdaraOS - Development Dockerfile
# =============================================================================
# Development image for hot reloading with volume mounts
# =============================================================================
# Note: For development with volume mounts, packages are installed at runtime
# because host volumes override build-time node_modules. The pnpm store is
# cached in a named volume for fast subsequent installs.
#
# For production: Use Dockerfile (multi-stage build with build-time install)
# =============================================================================

FROM node:22-alpine

# Install pnpm globally and development tools
RUN corepack enable && corepack prepare pnpm@latest --activate \
    && apk add --no-cache git

WORKDIR /app

# Set development environment
ENV NODE_ENV=development
ENV NEXT_TELEMETRY_DISABLED=1
ENV PORT=3000
ENV HOSTNAME="0.0.0.0"

# Expose port
EXPOSE 3000

# Working directory for next dev
WORKDIR /app/apps/web

# Startup: Install packages if needed, then start dev server
# The pnpm store is cached via volume mount for fast subsequent installs
CMD ["sh", "-c", "cd /app && if [ ! -d 'node_modules/.pnpm' ]; then echo 'ðŸ“¦ Installing packages (first run)...' && pnpm install; else echo 'ðŸ“¦ Checking packages...' && pnpm install --prefer-offline 2>/dev/null || true; fi && echo 'ðŸš€ Starting Next.js dev server...' && cd /app/apps/web && exec npx next dev --hostname 0.0.0.0 --port 3000"]
